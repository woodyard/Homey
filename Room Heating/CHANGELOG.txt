Generic Room Heating Control - Version History
==============================================

Author: Henrik Skovgaard
Created: 2025-12-31
Based on: Clara Heating v6.4.6

==============================================
Version 10.12.0 (2026-01-19)
==============================================
ğŸ”„ SMART SCHEDULE: Auto-exit manual override when device returns to schedule mode
- Manual override now monitors device.capabilitiesObj.onoff.smart_schedule property
- When smart_schedule becomes true, device has returned to automatic schedule mode
- System immediately exits manual override and resumes normal schedule operation
- Solves problem: System 90-min override vs user's shorter device manual control duration
- Example: User sets 30-min manual on device â†’ At 30 min: deviceâ†’auto â†’ System exits early
- checkManualOverrideMode() is now async to check device property
- Returns reason: 'smart_schedule' (early exit) or 'timeout' (normal 90-min expiry)
- Enhanced logging shows which expiration type occurred
- Notification: "ğŸ”„ Device â†’ auto â€¢ Override ended" vs "â±ï¸ Override ended"
- Only applies to TADO valves (smart plugs unchanged - no smart_schedule property)
- Respects user's device-level manual control duration instead of forcing 90 minutes
- Better synchronization between device and system manual control periods
- Safety: If property doesn't exist or check fails, falls back to normal 90-min timeout
- Function changes: checkManualOverrideMode() made async, manual expiry logging enhanced
- Files modified: room_heating.js (lines 1037-1113, 2788, 2850-2875)

==============================================
Version 10.11.0 (2026-01-18)
==============================================
âœ¨ RESUME: Set and verify temperature when resuming from any heating interruption
- Added new resumeNormalHeating() function for explicit resume logic with temperature verification
- When pause mode cancelled: TADO sets both onoff=true AND target_temperature with verification
- When pause mode expires: Explicit resume with temperature setting and verification
- When boost mode cancelled: TADO sets target back to schedule temperature with verification
- When boost mode expires: Explicit resume with temperature setting and verification
- When manual override cancelled: Explicit resume with temperature verification
- When manual override expires: Explicit resume with temperature setting and verification
- When window air settles: Uses same explicit resume logic with temperature verification
- When returning home from away: Explicit resume with temperature verification
- Smart plugs: Calculate correct state using hysteresis when resuming
- Debug notifications now show both onoff AND temperature changes during resume
- Example: "ğŸ› Verified: onoff=true" + "ğŸ› Verified: target_temperature=22Â°C"
- Prevents situation where only onoff shown but temperature not verified
- Resume logic respects away mode (uses away minimum) and inactivity (applies offset)
- Baseline (LastVerifiedTargetTemp) updated after resume to prevent false manual detection
- Functions updated: cancelPauseMode(), cancelBoostMode(), cancelManualOverrideMode(), cancelAllOverrideModes()
- Control heating: Away->home transition, window settle all use explicit resume
- Main execution: Cancel request, pause expiry, boost expiry, manual expiry all call explicit resume
- Significantly improves user confidence that heating is properly restored after any interruption

==============================================
Version 10.10.2 (2026-01-18)
==============================================
ğŸ”§ OPTIMIZE: Store smart plug baseline once per room, not per device
- Fixed inefficiency where LastVerifiedOnOff was updated for each device in a room
- Now stores baseline ONCE after all devices in room are processed
- For smart plugs: Store after all devices verified OR if no changes and all match expected
- Prevents multiple baseline updates for same state (was updating 2-3 times per run)
- Baseline storage moved from per-device loop to after-loop logic
- More efficient, cleaner code, same functionality
- Smart plug rooms with multiple devices benefit most from this optimization

==============================================
Version 10.10.1 (2026-01-18)
==============================================
ğŸ› DEBUG: Add debug notifications for queue and verification events
- New HeatingDebugMode Logic variable enables detailed debug notifications
- When enabled, sends notifications for command queue operations and verification
- Examples: "ğŸ“ Queued onoff=true", "âœ… Verified in 48ms: onoff=true", "ğŸ“¤ Sending onoff=true"
- Helps troubleshoot command verification and queue behavior without checking logs
- Set HeatingDebugMode=true in Homey Logic to enable, false to disable
- Debug messages prefixed with room name for multi-room setups
- Only affects notifications - logging behavior unchanged

==============================================
Version 10.10.0 (2026-01-18)
==============================================
ğŸ”§ VERIFIED-BASELINE: Only compare against verified device states for manual detection
- Changed manual detection to use LastVerifiedTargetTemp instead of ExpectedTargetTemp
- Only stores baseline when sendCommandWithVerification() confirms device accepted command
- Eliminates false positives from comparing against unverified expected values
- For TADO: Only updates LastVerifiedTargetTemp after target_temperature verification succeeds
- For smart plugs: Only updates LastVerifiedOnOff after all devices verified OR confirmed matching
- Manual detection now compares actual device state against last known VERIFIED state
- If no verified baseline exists, manual detection returns "not detected" (safe fallback)
- More reliable manual intervention detection - only triggers on actual device changes
- Debug: New log message "ğŸ“ Stored verified target: 22Â°C (baseline for manual detection)"
- Complements v10.9.0 state-based detection and verification system

==============================================
Version 10.9.2 (2026-01-18)
==============================================
ğŸ”„ RETRY: Auto-retry TADO temperature commands up to 3 times if not verified
- Added retry logic to sendCommandWithVerification() function
- If temperature verification fails, automatically retries up to 3 times (configurable)
- 2-second delay between retry attempts to allow device to process
- Fixes issue where TADO sometimes sets to default 18.1Â°C instead of target temperature
- Example: Target 20.5Â°C fails verification â†’ retry 1 â†’ retry 2 â†’ retry 3 â†’ success
- Logs show: "ğŸ”„ Retry attempt 2/3: target_temperature = 20.5"
- Success message indicates attempts: "âœ… Command verified successfully (after 2 attempts)"
- Applies to all device commands: onoff switches and target_temperature for TADO
- Smart plug commands also benefit from retry logic (though less likely to need it)
- Significantly improves reliability of TADO temperature setting
- Default maxRetries = 3, configurable via function parameter if needed

==============================================
Version 10.9.1 (2026-01-18)
==============================================
ğŸ› CRITICAL FIX: False manual override when returning from away mode
- Fixed bug where returning home triggered manual override for TADO rooms
- Problem: ExpectedTargetTemp still contained away mode minimum (18.1Â°C)
- When TADO auto-adjusted to schedule (20.5Â°C), system detected difference as manual change
- Result: "Home" notification followed by incorrect "Manual override â€¢ 90 min" notification
- Solution: Clear ExpectedTargetTemp when transitioning from awayâ†’home
- TADO's automatic temperature restoration is no longer treated as manual intervention
- Affected: TADO valve rooms (Oliver, SovevÃ¦relse, Stue) returning from away mode
- Example prevented: Away 18.1Â°C â†’ Home (TADO auto-sets 20.5Â°C) â†’ false "Manual override"
- Now shows: Away â†’ Home (correct behavior, no false manual override)
- Complements v10.6.6 and v10.6.7 fixes for away mode transition handling

==============================================
Version 10.8.6 (2026-01-17)
==============================================
ğŸ› Fix: Snowflake icon (â„ï¸) shown incorrectly during manual override for TADO
- Fixed bug where snowflake appeared in manual override notification when TADO was IDLE
- Problem: Manual override notification showed 'OFF' for TADO when not actively heating
- TADO has three states: HEATING (actively heating), IDLE (on but not heating), OFF (turned off)
- Snowflake should only appear when heating is completely OFF, not when IDLE
- Manual override notification now matches normal schedule notification logic
- Now shows: HEATING (no icon), IDLE (no icon), OFF (â„ï¸ snowflake)
- Example: Manual override at 22.5Â°C, room at 22.3Â°C â†’ IDLE state â†’ no snowflake
- Consistent with version 10.3.10 fix for normal notifications

==============================================
Version 10.8.5 (2026-01-17)
==============================================
ğŸ› CRITICAL FIX: Grace period blocks legitimate manual control detection
- Fixed bug where 7-minute grace period prevented manual temperature changes from being detected
- Problem: Grace period was meant to prevent false positives from automation's own changes
- But it blocked ALL detection, including real user manual changes (e.g., 22Â°C â†’ 22.5Â°C)
- Example: User changes temp â†’ Grace period active â†’ Detection skipped â†’ Next run resets to schedule
- Result: Manual changes ignored, temperature reset back to schedule value
- Root cause: Grace period was a band-aid for not properly updating ExpectedTargetTemp
- Solution: Reduced grace period from 7 minutes to 30 seconds (0.5 minutes)
- 30 seconds only accounts for network/async delays, not blocking detection across script runs
- ExpectedTargetTemp is now properly maintained (thanks to v10.8.4 fixes)
- Now: Manual change 22â†’22.5Â°C detected within 30 seconds â†’ Manual override activated
- System respects user's manual settings for 90 minutes as designed
- Grace period no longer spans multiple script runs (was 7 min > 5 min script interval)
- Trust ExpectedTargetTemp tracking: if actual â‰  expected after 30s â†’ manual intervention!
- Manual override feature now works as originally intended

==============================================
Version 10.8.4 (2026-01-17)
==============================================
ğŸ› CRITICAL FIX: Boost and pause modes cancelled by false manual override detection
- Fixed bug where boost/pause modes were cancelled shortly after activation
- Problem: controlHeatingBoost/Pause changed TADO temperature but didn't update ExpectedTargetTemp
- Next automatic script run (5 min later) detected difference and thought user made manual change
- Example: Boost sets 25Â°C â†’ 5 min later â†’ system sees 25Â°C vs expected 22Â°C â†’ "manual override detected"
- Result: Boost activated â†’ then immediately cancelled â†’ left in manual override mode instead
- Solution 1: activateBoostMode() now pre-sets ExpectedTargetTemp to boost temperature (25Â°C)
- Solution 2: controlHeatingBoost() updates ExpectedTargetTemp when setting TADO temperature
- Solution 3: checkBoostMode() resets grace period when boost expires (prevents false detection after)
- Solution 4: Same fixes applied to pause mode (activatePauseMode, controlHeatingPause, checkPauseMode)
- Affected: All TADO valve rooms (Oliver, SovevÃ¦relse, Stue) using boost or pause modes
- Smart plug rooms (Clara) unaffected - only use on/off switches, not temperature tracking
- Now: Single "ğŸš€ Boost activated" notification, boost runs for full 60 minutes without interference
- Manual intervention detection still works - only triggers for actual user-initiated changes

==============================================
Version 10.8.3 (2026-01-17)
==============================================
ğŸ› CRITICAL FIX: TADO target must be recalculated from scratch on air settle
- Fixed bug where TADO was still set to wrong temperature (18.1Â°C instead of 22Â°C)
- Problem: effectiveTarget variable had been modified by away mode logic earlier in function
- Using modified effectiveTarget resulted in wrong temperature when resuming after window settle
- Solution: Start fresh with slot.target when resuming, then apply away/inactivity logic cleanly
- Now calculates: slot.target â†’ apply away min (if away) â†’ apply inactivity offset (if inactive)
- Example: slot.target=22Â°C, away min=18Â°C â†’ if away then 18Â°C, if home+inactive then 20Â°C
- Ensures TADO gets absolutely correct temperature on first attempt when air settle completes
- Next script run will not need to correct the temperature

==============================================
Version 10.8.2 (2026-01-17)
==============================================
ğŸ› CRITICAL FIX: TADO set to wrong target temperature after air settle delay
- Fixed bug where TADO was set to incorrect temperature when window settle delay completed
- Problem: Inactivity offset was applied AFTER TADO was resumed, not before
- Window settle logic ran before inactivity logic in code flow
- Result: TADO resumed with base target (22Â°C) instead of effective target (e.g., 20Â°C with -2Â°C offset)
- Example: Room inactive â†’ window closes â†’ wait 10 min â†’ TADO resumed at 22Â°C (wrong!)
- Should be: Room inactive â†’ window closes â†’ wait 10 min â†’ TADO resumed at 20Â°C (correct!)
- Solution: Calculate effective target (including inactivity offset) before resuming TADO
- Now applies inactivity offset immediately when air settle completes, before setting target
- Smart plug behavior unchanged (already correctly calculated in hysteresis logic)
- Ensures TADO gets correct temperature immediately when heating resumes

==============================================
Version 10.8.1 (2026-01-17)
==============================================
ğŸ› CRITICAL FIX: "Air settled" notification not sent after window settle delay
- Fixed bug where "Air settled â€¢ Heat resumed" notification was not sent for TADO valves
- Problem: After window settle delay completed, code continued executing instead of returning
- TADO heating was resumed correctly, but notification changes were cleared/overridden
- Solution: Added explicit return 'window_settled_tado' for TADO valves after air settle
- Smart plugs continue to hysteresis logic (correct behavior - need to check temperature)
- Affects: TADO valve rooms (Oliver, SovevÃ¦relse, Stue) - now get proper notification
- Smart plug rooms (Clara) - behavior unchanged (already working correctly)
- Ensures users are notified when heating resumes after window closed delay

==============================================
Version 10.8.0 (2026-01-17)
==============================================
ğŸ›ï¸ Unified slot-override architecture
- Introduced unified getEffectiveSetting() function for all slot-based overrides
- All settings (inactivity, window timeouts) now use same override pattern
- Slot values take precedence over room defaults when defined
- Added getSettingSource() helper for logging override source ('slot override' or 'room default')
- Replaces multiple ad-hoc override checks with consistent pattern
- Documentation: See UNIFIED_SLOT_OVERRIDE_ARCHITECTURE.md and UNIFIED_SLOT_OVERRIDE_SYSTEM.md
- Settings supporting slot overrides: inactivityOffset, inactivityTimeout, windowOpenTimeout, windowClosedDelay
- Benefits: More maintainable, consistent behavior, easier to add new overridable settings

==============================================
Version 10.7.0 (2026-01-17)
==============================================
â±ï¸ Per-slot inactivity timeout support
- Added slot-level inactivityTimeout override capability
- Each schedule slot can now define custom inactivity timeout (overrides room default)
- Example: Night slot with 5min timeout, Day slot with 30min timeout
- Stored in global variable: SlotInactivityTimeout (null if using room default)
- Displayed in status showing effective value and source (slot vs room)
- Documentation: See SLOT_INACTIVITY_TIMEOUT_FEATURE.md
- Complements existing slot-level inactivityOffset override
- Enables fine-grained control over inactivity behavior per time period

==============================================
Version 10.6.13 (2026-01-16)
==============================================
ğŸ› Fix: Schedule gap when Day ends before lateEvening starts
- Fixed bug where schedule had gap between Day end and lateEvening start on holidays
- Problem: Weekday Day ends 20:00, but lateEvening starts 21:00 (when no school tomorrow)
- Gap from 20:00-21:00 would use default slot (first Morning slot) instead of extending Day
- Solution: If lateEvening starts later than last base slot ends, extend last slot to match
- Example: Weekday Day (06:00-20:00) auto-extends to (06:00-21:00) when using lateEvening
- Only affects holiday/vacation days when school tomorrow = false
- Ensures smooth schedule transitions without unexpected temperature changes

==============================================
Version 10.6.12 (2026-01-16)
==============================================
ğŸ”• Suppress "air settled" and "heat resumed" notifications when in away mode
- "Air settled â€¢ Heat resumed" notifications are now suppressed during TADO away mode
- These notifications are not relevant when nobody is home
- Functionality unchanged - only notification suppression during away mode
- Log still records event with "(away mode - notification suppressed)" indicator

==============================================
Version 10.6.11 (2026-01-15)
==============================================
ğŸ› CRITICAL FIX: Window settle delay triggered even for brief window openings
- Fixed bug where "Window closed â€¢ Waiting 10min" shown even if window only open for seconds
- Problem: Air settle delay started whenever window closed, regardless of how long it was open
- If window open < timeout, heating never turned off, so no need to wait for air to settle
- Solution: Only start settle delay if window was open long enough to trigger heating shutoff
- Example: Open window 5 sec â†’ close â†’ no delay (heating never affected)
- Example: Open window 6 min â†’ close â†’ 10 min delay (heating was off, air needs to settle)

==============================================
Version 10.6.10 (2026-01-15)
==============================================
ğŸ› CRITICAL FIX: Window closed delay notification sent immediately
- Fixed bug where "Air settled" notification appeared immediately after "Window closed"
- Problem: WindowClosedTime could trigger premature completion check
- Solution: Added minimum 60-second threshold to prevent immediate double notifications
- Ensures script MUST wait at least 60 seconds before "Air settled" notification
- Prevents both notifications from being sent with identical timestamps

==============================================
Version 10.6.9 (2026-01-15)
==============================================
ğŸ” Search child zones for motion and window sensors
- Added getZoneAndChildDevices() helper to search parent zone + all child zones
- Window sensors now detected in child zones (fixes "No window sensors found")
- Motion sensors now detected in child zones for proper activity tracking
- Supports complex zone hierarchies (e.g., "Stue / Spisestue" with "Stue" and "Spisestue" children)
- isWindowOpen() now searches child zones
- Backward compatible - works with both simple and hierarchical zone structures

==============================================
Version 10.6.8 (2026-01-15)
==============================================
ğŸ“Š CRITICAL FIX: Use TADO device temperature sensor directly by ID
- Fixed bug where TADO devices in different zones weren't found by zone filtering
- TADO rooms now get thermostat directly by device ID instead of filtering by zone
- Prioritizes TADO's built-in temperature sensor (more accurate at valve location)
- Falls back to zone sensors if TADO device not found or lacks temperature capability
- Affects: TADO valve rooms (Oliver, SovevÃ¦relse, Stue) - uses thermostat temperature
- Smart plug rooms (Clara) unchanged - continues using zone sensors
- Added detailed logging showing which sensor is used and current temperature value
- Fixes "TADO device has no temperature sensor" false warning

==============================================
Version 10.6.7 (2026-01-14)
==============================================
ğŸ› CRITICAL FIX: Away mode transition check MUST happen BEFORE manual detection
- Fixed execution order bug causing false positive manual override when arriving home
- Problem: detectManualIntervention() called BEFORE grace period reset in controlHeating()
- When arriving home: TADO auto-adjusts temp â†’ manual detection checks (stale grace) â†’ false positive
- Then too late: controlHeating() resets grace period (after damage already done)
- Solution: Moved awayâ†’home transition check to MAIN EXECUTION before manual intervention detection
- Now: Check away status early â†’ reset grace if transitioning â†’ THEN check for manual intervention
- Result: Grace period properly set before detection runs, preventing false positives
- Execution order: 1) Away check + grace reset, 2) Manual detection, 3) Control heating
- This ensures TADO's automatic awayâ†’home adjustments are protected by grace period

==============================================
Version 10.6.6 (2026-01-14)
==============================================
ğŸ› CRITICAL FIX: False positive manual override when returning from away mode
- Fixed bug where TADO rooms triggered manual override when arriving home
- Problem: TADO thermostats automatically adjust temperature when switching from awayâ†’home
- System compared new TADO target against stale away-mode ExpectedTargetTemp â†’ false positive
- Example: Away at 18Â°C â†’ TADO auto-adjusts to 20Â°C on arrival â†’ detected as "manual" change
- Solution: Reset grace period timer (LastAutomationChangeTime) when returning from away mode
- 7-minute grace period prevents false detection during TADO's automatic adjustment
- Affects: TADO valve rooms (Oliver, SovevÃ¦relse) - smart plug rooms unaffected
- Prevents: "Home" notification â†’ "Manual override" false positive sequence

==============================================
Version 10.6.5 (2026-01-14)
==============================================
ğŸ› CRITICAL FIX: Grace period constantly reset causing false manual override detection
- Fixed bug where LastAutomationChangeTime was updated on EVERY script run, even when no changes made
- Problem: Script runs frequently (events: motion, window, schedule), constantly resetting grace period
- Grace period never actually expired, then suddenly did when timing aligned â†’ false positive
- Between grace expiry, inactivity mode could toggle, changing target (21Â°C â†’ 20Â°C with -1Â°C offset)
- System detected its own inactivity changes as manual intervention after grace expired
- Solution: Only update LastAutomationChangeTime when ACTUALLY making physical changes
- Also increased grace period from 2 to 7 minutes for additional safety margin
- Example prevented: "Air settled â€¢ Heat resumed" at 15:45 â†’ "Manual override" at 15:50
- Grace period now properly protects against detecting automation's own temperature adjustments

==============================================
Version 10.6.4 (2026-01-14)
==============================================
ğŸ› CRITICAL FIX: Clear expected target when TADO turned off
- Fixed bug where stale ExpectedTargetTemp values caused false positive manual override detection
- Problem: When TADO turned off, ExpectedTargetTemp was left with old value
- Later schedule changes would compare against stale expected value â†’ false positive
- Example: System sets 20Â°C, turns off, schedule changes to 18Â°C â†’ false "manual override"
- Solution: Clear ExpectedTargetTemp (set to null) when turning TADO off
- detectManualIntervention() already handles null values correctly (returns detected=false)
- Prevents: False manual override notifications when schedule changes while TADO is off

==============================================
Version 10.6.3 (2026-01-13)
==============================================
ğŸ› CRITICAL FIX: False positive manual intervention detection
- Fixed bug where system detected its own temperature changes as manual interventions
- Problem: When turning TADO off (window open), stored currentTarget as expected value
- This caused false positive when system later calculated different target (e.g., due to schedule)
- Solution: Only store ExpectedTargetTemp when actively controlling (turnOn=true)
- Increased grace period from 30 seconds to 2 minutes (scripts run every 5 min)
- Now ALWAYS updates LastAutomationChangeTime when storing expected target
- Added detailed logging to track when expected values are stored
- Prevents: "Override ended â†’ Manual override" notification loop when window closes

==============================================
Version 10.6.2 (2026-01-13)
==============================================
ğŸ› CRITICAL FIX: Manual intervention detection not working when TADO already on
- Fixed bug where ExpectedTargetTemp was only stored when turning TADO on
- Now stores expected target on every heating control cycle (both on and off)
- Manual temperature changes now properly detected even when automation hasn't recently changed target
- Without this fix, manual intervention detection would fail if system was maintaining steady temperature
- Example: User changes SovevÃ¦relse from 21Â°C to 22Â°C now triggers manual override notification

==============================================
Version 10.6.1 (2026-01-13)
==============================================
ğŸ› Fix diagnostics logging during manual override mode
- Manual override now logs actual TADO target temperature instead of 0Â°C
- Diagnostics now show correct target (e.g., 22Â°C) instead of "Target: 0Â°C"
- Fixes misleading log entries during manual override

==============================================
Version 10.6.0 (2026-01-13)
==============================================
ğŸ¤š Add manual intervention detection and handling
- Detects manual temperature changes (TADO) and switch changes (smart plugs)
- Pauses automation for 90 minutes (configurable per room) when manual intervention detected
- Manual override has highest priority - cancels active boost/pause modes
- Auto-revert to schedule after timeout
- Cancel command now cancels boost, pause, AND manual override
- Boost/pause commands cancel manual override when activated
- Grace period (30 seconds) prevents detecting automation's own changes
- New global vars: ManualOverrideMode, ManualOverrideStartTime, ManualOverrideDuration, etc.
- New functions: activateManualOverrideMode(), cancelManualOverrideMode(), checkManualOverrideMode(), detectManualIntervention()
- Tracks expected values to detect changes: ExpectedTargetTemp (TADO), ExpectedOnOff (smart plugs)
- Notifications when manual override starts, ends, and is active

==============================================
Version 10.5.0 (2026-01-12)
==============================================
â¸ï¸ Add pause heating mode (opposite of boost)
- New "pause" argument: run('Clara', 'pause') forces heating OFF for 60 minutes
- Smart plugs: Turn off all radiators, ignore all conditions
- TADO valves: Turn completely OFF (onoff = false)
- Ignores temperature, schedule, window, inactivity, away mode during pause
- Latest call wins: pause cancels boost, boost cancels pause (mutually exclusive)
- Cancel command now cancels both boost and pause modes
- Automatic revert to schedule after 60 minutes
- New global vars: PauseMode, PauseStartTime, PauseDuration
- Notifications when pause starts, ends, and is active
- New functions: activatePauseMode(), cancelPauseMode(), checkPauseMode(), controlHeatingPause()

==============================================
Version 10.4.4 (2026-01-09)
==============================================
ğŸ› Fix next schedule showing wrong day type
- getNextScheduleChange() now correctly determines tomorrow's schedule type
- Friday evening no longer shows "School" when Saturday uses weekend schedule
- Properly checks if tomorrow is weekend/school day/holiday
- Shows actual first period from tomorrow's schedule, not today's
- Example: Friday 20:27 now shows "Night" (weekend) not "School" (weekday)

==============================================
Version 10.4.3 (2026-01-08)
==============================================
ğŸ”§ Fix Flow argument parsing
- Homey Flows pass "Clara, boost" as single string (not separate args)
- Script now splits comma-separated arguments automatically
- Works with both: Flow "Clara, boost" and HomeyScript run('Clara', 'boost')
- Example Flow input: "Clara, boost" or "oliver, cancel" (case-insensitive)

==============================================
Version 10.4.2 (2026-01-08)
==============================================
ğŸ”§ Make room names case-insensitive
- Can now use 'clara' or 'Clara', 'oliver' or 'Oliver'  
- Fixes "Unknown room" error when using lowercase names
- Example: run('clara', 'boost') works same as run('Clara', 'boost')

==============================================
Version 10.4.1 (2026-01-08)
==============================================
ğŸ›‘ Add cancel boost function
- New "cancel" argument: run('Clara', 'cancel') cancels active boost
- Immediately clears boost mode and resumes schedule
- Notification sent when boost is cancelled
- Works even if boost not active (safe to call anytime)

==============================================
Version 10.4.0 (2026-01-08)
==============================================
ğŸš€ Add boost heating mode
- New "boost" argument: run('Clara', 'boost') activates boost for 60 minutes  
- Smart plugs: Turn on all radiators, ignore schedule and hysteresis
- TADO valves: Set to 25Â°C boost temperature
- Ignores window open, inactivity, away mode during boost
- Automatic revert to schedule after 60 minutes
- New global vars: BoostMode, BoostStartTime, BoostDuration
- Notifications when boost starts and ends

==============================================
Version 10.3.11 (2026-01-08)
==============================================
â³ Add window closed delay for air to settle
- New setting: windowClosedDelay (seconds, default 600 = 10 minutes)
- After window closes, heating waits before resuming
- Allows air to mix and settle for accurate temperature reading
- Prevents heating from working harder due to cold air near sensor
- New global var: WindowClosedTime tracks when window was closed
- New action: 'window_closed_waiting' during settle period
- Notification shows "Window closed â€¢ Waiting Xmin" then "Air settled â€¢ Heat resumed"

==============================================
Version 10.3.10 (2026-01-05)
==============================================
ğŸ“± Fix snowflake icon appearing when TADO is IDLE
- Snowflake (â„ï¸) now only shows when heating is OFF, not IDLE
- IDLE is normal for TADO - means valve is on but not actively heating
- "OFF" = heating completely turned off (e.g., window open)
- "IDLE" = heating ready but room at target (no icon needed)

==============================================
Version 10.3.9 (2026-01-03)
==============================================
ğŸ› ï¸ CRITICAL FIX: Double checkInactivity() call caused wrong notification target
- checkInactivity() was called twice: once in controlHeating(), once before notification
- Between calls, zone could become active (e.g., person closing window)
- Second call returned different results, causing notification to show wrong target
- Example: TADO set to 20Â°C (with inactivity), but notification showed 21Â°C (no inactivity)
- Fix: Use stored EffectiveTemperature and InactivityMode flag instead of rechecking
- "IDLE" = heating ready but room at target (no icon needed)

==============================================
Version 10.3.8 (2026-01-03)
==============================================
ğŸ“± Changed window icon to wind icon
- Changed open window icon from ğŸªŸ to ğŸ’¨ (wind/draft)
- More intuitive - immediately suggests "air coming in from outside"
- Icons: ğŸ’¨=window open, ğŸ’¤=inactive, â„ï¸=heating off, ğŸš¶=away mode

==============================================
Version 10.3.7 (2026-01-03)
==============================================
ğŸ“± Remove redundant temperature comparisons from notifications
- Removed "21.9 > 20.75Â°C" and "19.7 < 20.5Â°C" from heat on/off messages
- Temperature comparison is redundant (already shown in status: ğŸŒ¡ï¸21.9â†’20.5Â°C)
- "Heat on â€¢ 19.7 < 20.5Â°C" â†’ "Heat on"
- "Heat off â€¢ 21.9 > 20.75Â°C" â†’ "Heat off"
- "Inactive (20min) â€¢ -2Â°C â†’ 20.5Â°C â€¢ Heat off â€¢ 21.9 > 20.75Â°C" â†’ "Inactive (20min) â€¢ -2Â°C â†’ 20.5Â°C â€¢ Heat off"

==============================================
Version 10.3.6 (2026-01-03)
==============================================
ğŸ“± Condensed change descriptions (Option 2 - More Condensed)
- "Window opened â€¢ Heating turned off (open 75 sec)" â†’ "Window (75s) â€¢ Heat off"
- "Schedule changed to 06:00-20:00 â€¢ Target: 20Â°C â†’ 22.5Â°C" â†’ "Schedule 06:00-20:00 â€¢ 20â†’22.5Â°C"
- "No activity detected (20+ min) â€¢ Target reduced by 2Â°C to 20.5Â°C" â†’ "Inactive (20min) â€¢ -2Â°C â†’ 20.5Â°C"
- "Activity detected - resumed â€¢ Target restored to 22.5Â°C" â†’ "Active â€¢ â†’ 22.5Â°C"
- "Nobody home detected (TADO) â€¢ Minimum temperature set: 18Â°C" â†’ "Away â€¢ Min 18Â°C"
- "Someone arrived home (TADO)" â†’ "Home"
- All messages now more compact while remaining clear

==============================================
Version 10.3.5 (2026-01-03)
==============================================
ğŸ“± Use walking person icon for away mode (matches TADO app)
- Changed away mode icon from ğŸ  to ğŸš¶ (walking person)
- Matches TADO app's own away mode symbol
- Icons: ğŸ’¨=window open, ğŸ’¤=inactive, â„ï¸=heating off, ğŸš¶=away mode

==============================================
Version 10.3.4 (2026-01-03)
==============================================
ğŸ“± Icon-only alerts - removed all text after icons
- Icons are now standalone, self-explanatory symbols
- ğŸ’¨ = window open
- ğŸ’¤ = room inactive
- â„ï¸ = heating off
- ğŸš¶ = away mode
- Ultra-clean, minimal notification format

==============================================
Version 10.3.3 (2026-01-03)
==============================================
ğŸ“± Condensed notifications - only show alert icons
- Window icon only shown when OPEN (not when closed)
- Inactive icon only shown when room IS inactive (not when active)
- Heating icon only shown when NOT heating (OFF/IDLE, not when ON/HEATING)
- House icon only shown when in AWAY mode (not when HOME)
- Result: Normal operation shows just temperature, alerts show relevant icons

==============================================
Version 10.3.2 (2026-01-03)
==============================================
ğŸ“± Compact notification format with icons
- Notifications now much more compact (3-4 lines vs 8-10 lines)
- Temperature display: "22.3â†’20Â°C" instead of separate lines
- Window: âœ“ (closed) or âœ— (open) - removed redundant status text
- Inactivity: âœ— (active) or âœ“ (inactive/sleeping)
- Heating: ğŸ”¥ for ON/HEATING, â„ï¸ for OFF/IDLE
- Added next schedule change time with target and period name
- All status on single line with icons for quick scanning

==============================================
Version 10.3.1 (2026-01-02)
==============================================
ğŸ“ Add specific 'window_closed' action when window closes

==============================================
Version 10.3.0 (2026-01-02)
==============================================
ğŸ› ï¸ CRITICAL: Fix missing log entries when window closes

==============================================
Version 10.2.9 (2026-01-02)
==============================================
ğŸ“ Fix inconsistent action logging between TADO and smart plugs

==============================================
Version 10.2.8 (2026-01-02)
==============================================
ğŸ”¥ CRITICAL: Stop sending unnecessary commands to TADO!

==============================================
Version 10.2.7 (2026-01-02)
==============================================
ğŸ› ï¸ CRITICAL FIX: effectiveTarget was undefined in logDiagnostics!

==============================================
Version 10.2.6 (2026-01-02)
==============================================
ğŸ• Fix DST timezone bug in getDanishLocalTime()

==============================================
Version 10.2.5 (2026-01-02)
==============================================
ğŸ› ï¸ Fix false schedule change notifications

==============================================
Version 10.2.4 (2026-01-02)
==============================================
ğŸ“ Fix diagnostic log to track effectiveTarget instead of slot.target (BROKEN!)

==============================================
Version 10.2.3 (2026-01-02)
==============================================
ğŸªŸ Add notification when window closes

==============================================
Version 10.2.2 (2026-01-02)
==============================================
ğŸ› ï¸ Fix confusing notifications when window open

==============================================
Version 10.2.1 (2026-01-02)
==============================================
ğŸ› ï¸ Fix window timeout flag reset when heating still on

==============================================
Version 10.2.0 (2026-01-02)
==============================================
ğŸ”¥ Use TADO onoff capability to turn off properly (BREAKING CHANGE)

==============================================
Version 10.1.6 (2026-01-02)
==============================================
ğŸ”¥ TADO window handling: Turn OFF instead of reducing temp

==============================================
Version 10.1.5 (2026-01-02)
==============================================
ğŸ› ï¸ Fix TADO window handling and notification status

==============================================
Version 10.1.4 (2025-12-31)
==============================================
ğŸ”§ Revert to getVariables() method - the working approach

==============================================
Version 10.1.3 (2025-12-31)
==============================================
ğŸ”§ Consistent Logic variable access across all functions (BROKEN)

==============================================
Version 10.1.2 (2025-12-31)
==============================================
ğŸ”§ Fix to use Homey's built-in Logic variables (not Better Logic)

==============================================
Version 10.1.1 (2025-12-31)
==============================================
ğŸ”§ Fix HeatingEnabled to use Logic variable (not global script variable)

==============================================
Version 10.1.0 (2025-12-31)
==============================================
ğŸšï¸ Global heating control via HeatingEnabled variable

==============================================
Version 10.0.1 (2025-12-31)
==============================================
ğŸ› ï¸ Fix excessive window logging and notifications

==============================================
Version 10.0.0 (2025-12-31)
==============================================
ğŸ”§ Configuration via global variables (BREAKING CHANGE)

==============================================
Version 9.0.0 (2025-12-31)
==============================================
ğŸ¯ Per-room schedules and settings (BREAKING CHANGE)

==============================================
Version 8.0.1 (2025-12-31)
==============================================
ğŸ› ï¸ Fix excessive logging bug

==============================================
Version 8.0.0 (2025-12-31)
==============================================
ğŸ¯ Target-based temperature control (BREAKING CHANGE)
- Schedules now use single "target" temperature instead of low/high
- Smart plugs automatically calculate hysteresis range (Â±0.25Â°C default)
- TADO valves use target directly - handles heating power automatically
- Clearer configuration: "I want 22.5Â°C" not "low 22.25, high 22.75"
- Per-room hysteresis setting for smart plugs
- TADO always gets correct target (not away temp when just off)
- Simplified inactivity/away logic: target - offset
- Global vars: Temperature (target), TemperatureLow/High (calculated for smart plugs)

==============================================
Version 7.1.0 (2025-12-31)
==============================================
ğŸ¯ Multi-room support with argument selection

==============================================
Version 7.0.0 (2025-12-31)
==============================================
ğŸŒŸ Zone-based generic implementation
